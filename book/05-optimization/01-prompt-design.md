# 5.1 有效提示词设计的原则

## 开始

在 AITDD 中,AI 输出质量很大程度上取决于提示词设计。通过适当的提示词设计,可以提高 AI 生成代码的质量并最大限度地提高开发效率。本章将学习提示词设计的实用原则和具体方法。

## 提示词设计的基本原则

### 1. 采用迭代改进方式

在 AITDD 中,不是一次性创建完美的提示词,而是基于持续改进的前提进行设计。

**基本循环:**
```
创建提示词 → 执行 → 评估结果 → 修正 → 再次执行
```

**实践要点:**
- 初次以 80% 的质量为目标,不追求完美
- 详细分析每次执行结果,识别改进点
- 通过积累小的修正来实现优化
- 记录改进日志并掌握模式

### 2. 纳入置信度评估

让 AI 评估自己输出的置信度,可以有效识别需要审查的部分。

**置信度指标:**
- **🟢 高置信度**: 可从参考文件中明确推导
- **🟡 中置信度**: 基于合理推测但需要确认
- **🔴 需判断**: 基于独立判断的生成,需要重点确认

### 3. 按步骤定制

针对 TDD 的每个步骤(Red、Green、Refactor、Validation),优化提示词。

**各步骤的特点:**
- **Red**: 重视测试创建的明确性和全面性
- **Green**: 最小实现和防止意外更改
- **Refactor**: 平衡质量提升和功能保持
- **Validation**: 全面的质量检查和问题发现

## AITDD 中的提示词模式

### 模式1: TODO 记录指示

让 AI 以 TODO 格式记录需要确认的项目。

**基本模板:**
```markdown
## 提示词中的指示示例

请执行以下处理并将结果记录为 TODO 列表:

**执行内容:**
[具体指示内容]

**TODO 记录格式:**
```markdown
## [步骤名称]结果 TODO

### 🟢 高置信度项目
- [ ] [文件名](相对路径) 的具体确认内容

### 🟡 中置信度项目
- [ ] [文件名](相对路径) 的推定内容的妥当性确认

### 🔴 需判断项目
- [ ] 详细确认: [文件名](相对路径) 的组织特定内容
```

**参考文件:** [指定文件列表]
**输出文件:** `./todos/[步骤名称]-check.md`
```

### 模式2: 置信度评估指示

让 AI 明确说明生成内容的根据和置信度。

**基本模板:**
```markdown
## 置信度评估指示

请按以下标准评估每个生成内容的置信度:

**评估标准:**
- 🟢 绿灯: 可从参考文件中明确推测
- 🟡 黄灯: 合理推测但需要确认
- 🔴 红灯: 基于独立判断的生成

**评估对象:**
1. 生成代码的各个功能
2. 测试用例的选择理由
3. 实现方针的决策依据

**输出格式:**
- 为每个项目添加信号灯标记
- 明确标注作为根据的参考文件部分
- 简洁说明推测理由
```

### 模式3: 分阶段细化指示

用于逐步推进复杂实现的模式。

**基本模板:**
```markdown
## 分阶段实施指示

请按以下顺序逐步推进实施:

**Phase 1: 基本结构**
- 最小限度的操作确认
- 主要函数/类的骨架
- 基本测试用例

**Phase 2: 功能扩展**
- 具体功能实施
- 错误处理
- 追加测试用例

**Phase 3: 优化**
- 性能改进
- 代码质量提升
- 综合测试

**每个阶段后的确认:**
- 报告测试执行结果
- 实施置信度评估
- 整理下一阶段的课题
```

## 实用的提示词构成要素

### 必需要素检查清单

创建提示词时必须包含的要素:

- [ ] **明确定义目的**
  - 清晰说明想要实现什么
  - 期望输出的具体格式

- [ ] **指定参考文件**
  - 明确标注应作为根据的文件
  - 说明文件之间的关系

- [ ] **置信度评估指示**
  - 应用信号灯系统的指示
  - 明确定义评估标准

- [ ] **指定输出格式**
  - 指定文件名和保存位置
  - 详细指定 Markdown 格式等

- [ ] **明确标注约束和注意事项**
  - 不应更改的部分
  - 特殊考虑事项

### 可模板化的部分

**标准头部示例:**
```markdown
## [步骤名称] 执行指示

**目的:** [具体目的]
**参考文件:** [文件列表]
**输出文件:** [保存路径]

**置信度评估:**
为每个生成内容用🟢🟡🔴显示置信度

**约束事项:**
- [重要约束事项]
```

### 需要定制的部分

需要针对项目特定进行定制的要素:

1. **领域特定的术语/概念**
   - 行业特定术语的定义
   - 项目内的命名规范

2. **技术栈特定的约束**
   - 使用框架的约束
   - 性能要求

3. **组织特定的规则**
   - 编码规范
   - 安全准则

## 确保质量的提示词技法

### 1. 防止意外实施

**对策技法:**
```markdown
## 明确实施约束

**允许变更范围:**
- 可变更: [具体的文件/函数名]
- 禁止变更: [现有正常工作的部分]

**实施方针:**
- 以最小变更达成目的
- 最小化对现有功能的影响
- 以新增为基本,现有修改最小化

**确认检查:**
- [ ] 是否包含指定范围外的变更
- [ ] 现有测试是否继续成功
- [ ] 是否发生了意外副作用
```

### 2. 明确与参考源文件的关系

**关系明示示例:**
```markdown
## 参考文件关系图

**主要参考:**
- `spec.md` → 需求定义的根据
- `existing_test.js` → 现有规格确认
- `config.json` → 配置规格参考

**派生参考:**
- `utils.js` → 现有工具的活用
- `types.ts` → 类型定义的一致性确保

**生成时的参考优先级:**
1. 主要参考为最优先
2. 矛盾内容采用主要参考
3. 不明确的点明确记录为问题
```

### 3. 分阶段细化的实施

**细化策略:**
```markdown
## 分阶段细化过程

**Level 1: 骨架创建**
- 接口定义
- 主要函数的签名
- 基本错误处理

**Level 2: 功能实施**
- 业务逻辑的实施
- 详细错误处理
- 输入值验证

**Level 3: 优化/完成**
- 性能优化
- 边缘情况对应
- 文档整备

**各级别的确认项目:**
- 测试执行结果
- 置信度评估
- 下一级别的课题
```

## 实践练习

### 练习1: 基本提示词的创建

请为以下场景创建提示词:

**场景:** 用户认证功能的测试用例创建
**参考文件:** `auth_spec.md`, `user_model.js`
**期望输出:** Jest 格式的测试文件

**应创建的要素:**
1. 明确的目的定义
2. 参考文件的指定
3. 置信度评估的指示
4. 输出格式的指定

### 练习2: 分阶段实施提示词的设计

**场景:** REST API 端点的实施
**要求:** 包含复杂数据处理
**约束:** 活用现有中间件

**应设计的要素:**
1. 3个阶段的实施阶段
2. 各阶段的成果物
3. 阶段间的确认项目

## 总结

有效提示词设计的核心如下:

1. **迭代改进**: 不追求一次性完美,以持续改进为前提
2. **置信度评估**: 可视化 AI 的推测部分,实现高效审查
3. **按步骤优化**: 针对 TDD 各阶段的提示词设计
4. **质量控制**: 防止意外实施和明确参考源

下一节将详细学习具体活用这些原则的 AI 推理可视化技术。
